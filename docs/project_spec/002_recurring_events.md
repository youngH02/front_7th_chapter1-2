# 반복 일정 기능

## 기능 개요

사용자가 일정을 반복 유형(매일, 매주, 매월, 매년)으로 설정하고, 반복 일정을 캘린더에 표시하며, 개별 또는 전체 수정/삭제할 수 있는 기능입니다.

## 상세 요구사항

### 1. 반복 유형 선택

#### 1.1. 반복 유형 옵션

- 일정 생성 또는 수정 시 반복 유형을 선택할 수 있다
- 반복 유형 옵션: 없음(none), 매일(daily), 매주(weekly), 매월(monthly), 매년(yearly)
- 기본값은 '없음'으로 설정된다

#### 1.2. 반복 유형별 생성 규칙

1.2.1. 매일 반복

- 선택한 날짜부터 종료일까지 매일 일정이 생성된다
- 시작 시간과 종료 시간은 원본 일정과 동일하게 유지된다

  1.2.2. 매주 반복

- 선택한 날짜의 요일을 기준으로 매주 같은 요일에 일정이 생성된다
- 예: 월요일에 생성하면 매주 월요일마다 일정이 생성된다

  1.2.3. 매월 반복

- 선택한 날짜의 일(day)을 기준으로 매월 같은 날짜에 일정이 생성된다
- 31일에 매월 반복을 선택하면 31일이 있는 달에만 일정이 생성된다
- 31일이 없는 달(2월, 4월, 6월, 9월, 11월)에는 일정이 생성되지 않는다
- 예: 1월 31일 → 3월 31일, 5월 31일, 7월 31일... (2월은 건너뜀)

  1.2.4. 매년 반복

- 선택한 날짜의 월과 일을 기준으로 매년 같은 날짜에 일정이 생성된다
- 윤년 2월 29일에 매년 반복을 선택하면 2월 29일이 있는 해에만 일정이 생성된다
- 평년에는 해당 일정이 생성되지 않는다
- 예: 2024년 2월 29일 → 2028년 2월 29일, 2032년 2월 29일...

#### 1.3. 반복 일정 겹침 처리

- 반복 일정은 일정 겹침 검사를 수행하지 않는다
- 반복 일정끼리 또는 일반 일정과 시간이 겹쳐도 경고 없이 생성된다

### 2. 반복 일정 표시

#### 2.1. 캘린더 뷰 표시

- 캘린더 뷰(주간/월간)에서 반복 일정을 아이콘으로 구분하여 표시한다
- 반복 아이콘: Material UI의 `Repeat` 아이콘 사용
- 반복 일정 박스에 아이콘을 함께 표시하여 일반 일정과 구분한다

#### 2.2. 이벤트 리스트 표시

- 이벤트 리스트에서도 반복 일정에 반복 아이콘을 표시한다
- 반복 유형 정보를 함께 표시한다 (예: "매주 반복", "매월 반복")

### 3. 반복 종료 조건

#### 3.1. 종료일 설정

- 반복 종료 조건으로 특정 날짜를 지정할 수 있다
- 종료일 입력 필드는 날짜 선택기로 제공된다
- 종료일은 선택 사항이며, 설정하지 않으면 기본값으로 2025-12-31까지 생성된다

#### 3.2. 최대 종료일

- 예제 특성상 반복 일정은 최대 2025-12-31까지만 생성된다
- 사용자가 2025-12-31 이후 날짜를 입력해도 2025-12-31까지만 생성된다

### 4. 반복 일정 수정

#### 4.1. 수정 옵션 선택

- 반복 일정을 수정하려고 할 때 수정 범위를 선택하는 다이얼로그가 표시된다
- 다이얼로그 제목: "반복 일정 수정"
- 다이얼로그 메시지: "해당 일정만 수정하시겠어요?"
- 버튼: "예" (단일 수정), "아니오" (전체 수정)

#### 4.2. 단일 일정 수정

4.2.1. 수정 동작

- "예" 버튼을 클릭하면 선택한 일정만 수정된다
- 수정된 일정은 반복 일정에서 분리되어 일반 일정으로 변경된다
- 반복 유형이 'none'으로 변경된다

  4.2.2. UI 변경

- 수정된 일정의 반복 아이콘이 사라진다
- 캘린더 뷰와 이벤트 리스트에서 일반 일정으로 표시된다

  4.2.3. 원본 반복 일정 유지

- 원본 반복 일정의 다른 인스턴스는 영향을 받지 않는다
- 수정되지 않은 다른 날짜의 반복 일정은 그대로 유지된다

#### 4.3. 전체 일정 수정

4.3.1. 수정 동작

- "아니오" 버튼을 클릭하면 반복 일정의 모든 인스턴스가 수정된다
- 원본 일정의 정보가 변경되고, 모든 반복 인스턴스에 반영된다

  4.3.2. 반복 설정 유지

- 반복 유형과 종료일은 그대로 유지된다
- 반복 아이콘도 계속 표시된다

  4.3.3. 변경 사항 반영

- 제목, 시간, 설명, 위치, 카테고리 등 수정된 모든 정보가 반복 일정 전체에 적용된다

### 5. 반복 일정 삭제

#### 5.1. 삭제 옵션 선택

- 반복 일정을 삭제하려고 할 때 삭제 범위를 선택하는 다이얼로그가 표시된다
- 다이얼로그 제목: "반복 일정 삭제"
- 다이얼로그 메시지: "해당 일정만 삭제하시겠어요?"
- 버튼: "예" (단일 삭제), "아니오" (전체 삭제)

#### 5.2. 단일 일정 삭제

5.2.1. 삭제 동작

- "예" 버튼을 클릭하면 선택한 일정만 삭제된다
- 해당 날짜의 반복 일정 인스턴스만 제거된다

  5.2.2. 원본 반복 일정 유지

- 원본 반복 일정의 다른 인스턴스는 영향을 받지 않는다
- 삭제되지 않은 다른 날짜의 반복 일정은 그대로 유지된다

#### 5.3. 전체 일정 삭제

5.3.1. 삭제 동작

- "아니오" 버튼을 클릭하면 반복 일정의 모든 인스턴스가 삭제된다
- 원본 일정과 생성된 모든 반복 인스턴스가 제거된다

  5.3.2. 완전 제거

- 캘린더 뷰와 이벤트 리스트에서 해당 반복 일정이 완전히 사라진다

### 특수 케이스

1. 31일 매월 반복

   - 31일에 매월 반복을 선택하면 31일이 있는 달에만 일정이 생성된다
   - 2월, 4월, 6월, 9월, 11월에는 일정이 생성되지 않는다
   - 예: 1월 31일 → 3월 31일, 5월 31일, 7월 31일, 8월 31일, 10월 31일, 12월 31일

2. 윤년 2월 29일 매년 반복

   - 2월 29일에 매년 반복을 선택하면 윤년에만 일정이 생성된다
   - 평년(2월 29일이 없는 해)에는 일정이 생성되지 않는다
   - 예: 2024년 2월 29일 → 2028년 2월 29일 (2025, 2026, 2027년은 건너뜀)

3. 반복 일정 겹침

   - 반복 일정은 일정 겹침 검사를 수행하지 않는다
   - 반복 일정끼리 시간이 겹쳐도 모두 생성된다
   - 일반 일정과 반복 일정이 겹쳐도 경고 없이 생성된다

4. 반복 일정 수정 후 재수정
   - 단일 수정으로 일반 일정이 된 일정을 다시 수정할 때는 수정 옵션 다이얼로그가 표시되지 않는다
   - 일반 일정으로 처리되어 바로 수정된다

### 에러 처리

1. 종료일 유효성 검증

   - 종료일이 시작일보다 이전이면 에러 메시지 표시: "종료일은 시작일 이후여야 합니다."
   - 종료일이 2025-12-31 이후이면 자동으로 2025-12-31로 조정된다

2. 반복 유형 미선택
   - 반복 유형이 선택되지 않으면 기본값 'none'으로 처리된다
   - 일반 일정으로 저장된다

### 제약사항

1. API 사용

   - 기존 일정 API를 활용하며, 새로운 API 엔드포인트는 추가하지 않는다
   - 반복 일정 생성은 클라이언트 측에서 처리한다

2. 최대 종료일

   - 예제 특성상 반복 일정은 최대 2025-12-31까지만 생성된다
   - 실제 프로덕션에서는 더 긴 기간을 지원할 수 있다

3. 반복 간격

   - 현재는 반복 간격(interval)을 1로 고정한다
   - 예: 매일 반복은 1일마다, 매주 반복은 1주마다
   - 향후 "2주마다", "3개월마다" 등의 간격 설정 기능을 추가할 수 있다

4. 반복 일정 ID 관리
   - 반복 일정의 각 인스턴스는 고유한 ID를 가진다
   - 원본 일정 ID를 기반으로 날짜를 조합하여 생성한다
   - 예: `original-id_2025-01-15`, `original-id_2025-01-22`

## 기술적 맥락

- **프레임워크**: React 19.1.0
- **UI 라이브러리**: Material UI 7.2.0
- **상태 관리**: React Hooks (useState, useEffect)
- **테스트**: Vitest, Testing Library
- **데이터 저장**: 기존 API 엔드포인트 사용 (MSW로 모킹)
- **타입 시스템**: TypeScript (strict mode)
- **날짜 처리**: JavaScript Date 객체 사용
- **반복 일정 생성**: 클라이언트 측에서 날짜 계산 및 인스턴스 생성
