# 테스트 설계 문서 - 반복 일정 기능

## 1. 명세서 정보

- 명세서 파일: docs/project_spec/002_recurring_events.md
- 분석 메모:
  - 핵심 기능: 반복 유형 선택(매일/매주/매월/매년), 반복 일정 표시, 수정/삭제(단일/전체)
  - 제약: 최대 종료일 2025-12-31, 반복 간격 1 고정, 겹침 검사 미수행
  - 리스크: 31일 매월 반복, 윤년 2월 29일 매년 반복, 반복 일정 ID 관리

## 2. 전체 테스트 케이스

| ID     | 우선순위 | 범위        | 케이스 유형 | 제목                           | 설명                                                          | 명세 참조          | 전제·입력                                                     | 기대 결과                                                                | 실패 신호                              |
| ------ | -------- | ----------- | ----------- | ------------------------------ | ------------------------------------------------------------- | ------------------ | ------------------------------------------------------------- | ------------------------------------------------------------------------ | -------------------------------------- |
| TD-001 | High     | unit        | 정상 케이스 | 매일 반복 일정 생성            | 매일 반복 유형으로 일정 생성 시 종료일까지 매일 일정이 생성됨 | 1.2.1              | 시작일: 2025-01-01, 종료일: 2025-01-07, 반복: daily           | 7개 일정 생성 (2025-01-01 ~ 2025-01-07)                                  | 생성된 일정 개수 불일치                |
| TD-002 | High     | unit        | 정상 케이스 | 매주 반복 일정 생성            | 매주 반복 유형으로 일정 생성 시 같은 요일에 일정이 생성됨     | 1.2.2              | 시작일: 2025-01-06 (월요일), 종료일: 2025-01-27, 반복: weekly | 4개 일정 생성 (매주 월요일)                                              | 생성된 일정 개수 또는 요일 불일치      |
| TD-003 | High     | unit        | 정상 케이스 | 매월 반복 일정 생성            | 매월 반복 유형으로 일정 생성 시 같은 날짜에 일정이 생성됨     | 1.2.3              | 시작일: 2025-01-15, 종료일: 2025-04-15, 반복: monthly         | 4개 일정 생성 (매월 15일)                                                | 생성된 일정 개수 또는 날짜 불일치      |
| TD-004 | High     | unit        | 정상 케이스 | 매년 반복 일정 생성            | 매년 반복 유형으로 일정 생성 시 같은 월/일에 일정이 생성됨    | 1.2.4              | 시작일: 2024-03-15, 종료일: 2025-12-31, 반복: yearly          | 2개 일정 생성 (2024-03-15, 2025-03-15)                                   | 생성된 일정 개수 또는 날짜 불일치      |
| TD-005 | High     | unit        | 경계 케이스 | 31일 매월 반복 생성            | 31일에 매월 반복 선택 시 31일이 있는 달에만 생성됨            | 1.2.3, 특수케이스1 | 시작일: 2025-01-31, 종료일: 2025-12-31, 반복: monthly         | 7개 일정 생성 (1월, 3월, 5월, 7월, 8월, 10월, 12월 31일)                 | 2월, 4월, 6월, 9월, 11월에 일정 생성됨 |
| TD-006 | High     | unit        | 경계 케이스 | 윤년 2월 29일 매년 반복 생성   | 2월 29일에 매년 반복 선택 시 윤년에만 생성됨                  | 1.2.4, 특수케이스2 | 시작일: 2024-02-29, 종료일: 2025-12-31, 반복: yearly          | 1개 일정 생성 (2024-02-29만, 2025년은 평년)                              | 2025년에도 일정 생성됨                 |
| TD-007 | Medium   | unit        | 정상 케이스 | 반복 유형 기본값 확인          | 반복 유형 미선택 시 기본값 'none' 설정됨                      | 1.1                | 반복 유형 미선택                                              | 반복 유형 'none'                                                         | 다른 값으로 설정됨                     |
| TD-008 | Medium   | unit        | 정상 케이스 | 종료일 기본값 확인             | 종료일 미설정 시 2025-12-31로 설정됨                          | 3.1                | 종료일 미입력                                                 | 종료일 2025-12-31                                                        | 다른 날짜로 설정됨                     |
| TD-009 | Medium   | unit        | 경계 케이스 | 종료일 최대값 제한             | 2025-12-31 이후 날짜 입력 시 2025-12-31로 조정됨              | 3.2                | 종료일: 2026-06-30                                            | 종료일 2025-12-31로 조정                                                 | 입력한 날짜 그대로 설정됨              |
| TD-010 | High     | unit        | 예외 케이스 | 종료일 유효성 검증 실패        | 종료일이 시작일보다 이전이면 에러 표시                        | 에러처리1          | 시작일: 2025-02-01, 종료일: 2025-01-01                        | 에러 메시지: "종료일은 시작일 이후여야 합니다."                          | 에러 없이 저장됨                       |
| TD-011 | High     | unit        | 정상 케이스 | 반복 일정 ID 생성              | 반복 일정 인스턴스마다 고유 ID 생성됨                         | 제약사항4          | 원본 ID: "event-1", 날짜: 2025-01-15                          | ID: "event-1_2025-01-15"                                                 | ID 중복 또는 형식 불일치               |
| TD-012 | Medium   | unit        | 정상 케이스 | 반복 일정 겹침 미검사          | 반복 일정은 겹침 검사를 수행하지 않음                         | 1.3, 특수케이스3   | 같은 시간대 반복 일정 2개 생성                                | 경고 없이 모두 생성됨                                                    | 겹침 경고 표시됨                       |
| TD-013 | High     | integration | 정상 케이스 | 캘린더 뷰 반복 아이콘 표시     | 캘린더 뷰에서 반복 일정에 Repeat 아이콘 표시됨                | 2.1                | 반복 일정 생성 후 캘린더 뷰 확인                              | Repeat 아이콘 표시됨                                                     | 아이콘 미표시                          |
| TD-014 | High     | integration | 정상 케이스 | 이벤트 리스트 반복 정보 표시   | 이벤트 리스트에서 반복 유형 정보 표시됨                       | 2.2                | 매주 반복 일정 생성 후 리스트 확인                            | "매주 반복" 텍스트 표시                                                  | 반복 정보 미표시                       |
| TD-015 | High     | integration | 정상 케이스 | 단일 일정 수정 다이얼로그 표시 | 반복 일정 수정 시 수정 범위 선택 다이얼로그 표시됨            | 4.1                | 반복 일정 수정 버튼 클릭                                      | 다이얼로그 제목: "반복 일정 수정", 메시지: "해당 일정만 수정하시겠어요?" | 다이얼로그 미표시                      |
| TD-016 | High     | integration | 정상 케이스 | 단일 일정만 수정               | "예" 선택 시 선택한 일정만 수정되고 일반 일정으로 변경됨      | 4.2                | 반복 일정 수정 다이얼로그에서 "예" 클릭                       | 선택한 일정만 수정, 반복 유형 'none', 아이콘 사라짐                      | 전체 일정 수정됨                       |
| TD-017 | High     | integration | 정상 케이스 | 전체 일정 수정                 | "아니오" 선택 시 모든 반복 인스턴스가 수정됨                  | 4.3                | 반복 일정 수정 다이얼로그에서 "아니오" 클릭                   | 모든 반복 인스턴스 수정, 반복 유형 유지, 아이콘 유지                     | 단일 일정만 수정됨                     |
| TD-018 | Medium   | integration | 정상 케이스 | 단일 수정 후 원본 유지         | 단일 수정 후 다른 반복 인스턴스는 영향 없음                   | 4.2.3              | 반복 일정 중 하나만 단일 수정                                 | 수정되지 않은 다른 인스턴스는 원본 유지                                  | 다른 인스턴스도 변경됨                 |
| TD-019 | High     | integration | 정상 케이스 | 단일 일정 삭제 다이얼로그 표시 | 반복 일정 삭제 시 삭제 범위 선택 다이얼로그 표시됨            | 5.1                | 반복 일정 삭제 버튼 클릭                                      | 다이얼로그 제목: "반복 일정 삭제", 메시지: "해당 일정만 삭제하시겠어요?" | 다이얼로그 미표시                      |
| TD-020 | High     | integration | 정상 케이스 | 단일 일정만 삭제               | "예" 선택 시 선택한 일정만 삭제됨                             | 5.2                | 반복 일정 삭제 다이얼로그에서 "예" 클릭                       | 선택한 일정만 삭제, 다른 인스턴스 유지                                   | 전체 일정 삭제됨                       |
| TD-021 | High     | integration | 정상 케이스 | 전체 일정 삭제                 | "아니오" 선택 시 모든 반복 인스턴스가 삭제됨                  | 5.3                | 반복 일정 삭제 다이얼로그에서 "아니오" 클릭                   | 모든 반복 인스턴스 삭제                                                  | 단일 일정만 삭제됨                     |
| TD-022 | Medium   | integration | 정상 케이스 | 단일 수정 후 재수정            | 단일 수정으로 일반 일정이 된 일정 재수정 시 다이얼로그 미표시 | 특수케이스4        | 단일 수정된 일정 다시 수정                                    | 다이얼로그 없이 바로 수정                                                | 다이얼로그 표시됨                      |
| TD-023 | Low      | unit        | 부정 케이스 | 잘못된 반복 유형 입력          | 지원하지 않는 반복 유형 입력 시 기본값 처리                   | 1.1                | 반복 유형: "invalid"                                          | 기본값 'none'으로 처리                                                   | 에러 발생                              |
| TD-024 | Low      | unit        | 부정 케이스 | 음수 종료일 입력               | 잘못된 날짜 형식 입력 시 에러 처리                            | 3.1                | 종료일: "invalid-date"                                        | 에러 메시지 또는 기본값 처리                                             | 시스템 크래시                          |
| TD-025 | Medium   | unit        | 경계 케이스 | 시작일과 종료일 동일           | 시작일과 종료일이 같을 때 1개 일정만 생성됨                   | 1.2.1              | 시작일: 2025-01-01, 종료일: 2025-01-01, 반복: daily           | 1개 일정 생성                                                            | 0개 또는 2개 이상 생성                 |
| TD-026 | Medium   | unit        | 경계 케이스 | 반복 간격 1 고정 확인          | 반복 간격이 1로 고정되어 있음                                 | 제약사항3          | 반복 간격 확인                                                | interval: 1                                                              | 다른 값으로 설정됨                     |

## 3. 명세 vs 테스트 커버리지

| 명세 항목              | 정상    | 예외    | 경계    | 부정    | 담당 테스트    | 메모                   |
| ---------------------- | ------- | ------- | ------- | ------- | -------------- | ---------------------- |
| 1.1 반복 유형 옵션     | ✓TD-007 | -       | -       | ✓TD-023 | TD-007, TD-023 | 기본값 및 부정 케이스  |
| 1.2.1 매일 반복        | ✓TD-001 | -       | ✓TD-025 | -       | TD-001, TD-025 | 정상 및 경계 케이스    |
| 1.2.2 매주 반복        | ✓TD-002 | -       | -       | -       | TD-002         | 정상 케이스            |
| 1.2.3 매월 반복        | ✓TD-003 | -       | ✓TD-005 | -       | TD-003, TD-005 | 정상 및 31일 경계      |
| 1.2.4 매년 반복        | ✓TD-004 | -       | ✓TD-006 | -       | TD-004, TD-006 | 정상 및 윤년 경계      |
| 1.3 겹침 처리          | ✓TD-012 | -       | -       | -       | TD-012         | 겹침 미검사 확인       |
| 2.1 캘린더 뷰 표시     | ✓TD-013 | -       | -       | -       | TD-013         | 아이콘 표시            |
| 2.2 이벤트 리스트 표시 | ✓TD-014 | -       | -       | -       | TD-014         | 반복 정보 표시         |
| 3.1 종료일 설정        | ✓TD-008 | -       | -       | ✓TD-024 | TD-008, TD-024 | 기본값 및 부정 케이스  |
| 3.2 최대 종료일        | -       | -       | ✓TD-009 | -       | TD-009         | 경계 케이스            |
| 4.1 수정 옵션 선택     | ✓TD-015 | -       | -       | -       | TD-015         | 다이얼로그 표시        |
| 4.2 단일 일정 수정     | ✓TD-016 | -       | -       | -       | TD-016, TD-018 | 단일 수정 및 원본 유지 |
| 4.3 전체 일정 수정     | ✓TD-017 | -       | -       | -       | TD-017         | 전체 수정              |
| 5.1 삭제 옵션 선택     | ✓TD-019 | -       | -       | -       | TD-019         | 다이얼로그 표시        |
| 5.2 단일 일정 삭제     | ✓TD-020 | -       | -       | -       | TD-020         | 단일 삭제              |
| 5.3 전체 일정 삭제     | ✓TD-021 | -       | -       | -       | TD-021         | 전체 삭제              |
| 에러처리1 종료일 검증  | -       | ✓TD-010 | -       | -       | TD-010         | 예외 케이스            |
| 제약사항3 반복 간격    | -       | -       | ✓TD-026 | -       | TD-026         | 경계 케이스            |
| 제약사항4 ID 관리      | ✓TD-011 | -       | -       | -       | TD-011         | 정상 케이스            |
| 특수케이스4 재수정     | ✓TD-022 | -       | -       | -       | TD-022         | 정상 케이스            |

## 3-1. 명세-테스트 매칭 목록

| 명세 번호   | 명세 설명          | 매핑된 테스트 ID | 누락 여부 | 비고                       |
| ----------- | ------------------ | ---------------- | --------- | -------------------------- |
| 1.1         | 반복 유형 옵션     | TD-007, TD-023   | 없음      | 기본값 및 부정 케이스 포함 |
| 1.2.1       | 매일 반복          | TD-001, TD-025   | 없음      | 정상 및 경계 케이스 포함   |
| 1.2.2       | 매주 반복          | TD-002           | 없음      | 정상 케이스                |
| 1.2.3       | 매월 반복          | TD-003, TD-005   | 없음      | 정상 및 31일 경계 포함     |
| 1.2.4       | 매년 반복          | TD-004, TD-006   | 없음      | 정상 및 윤년 경계 포함     |
| 1.3         | 겹침 처리          | TD-012           | 없음      | 겹침 미검사 확인           |
| 2.1         | 캘린더 뷰 표시     | TD-013           | 없음      | 아이콘 표시                |
| 2.2         | 이벤트 리스트 표시 | TD-014           | 없음      | 반복 정보 표시             |
| 3.1         | 종료일 설정        | TD-008, TD-024   | 없음      | 기본값 및 부정 케이스 포함 |
| 3.2         | 최대 종료일        | TD-009           | 없음      | 경계 케이스                |
| 4.1         | 수정 옵션 선택     | TD-015           | 없음      | 다이얼로그 표시            |
| 4.2         | 단일 일정 수정     | TD-016, TD-018   | 없음      | 단일 수정 및 원본 유지     |
| 4.3         | 전체 일정 수정     | TD-017           | 없음      | 전체 수정                  |
| 5.1         | 삭제 옵션 선택     | TD-019           | 없음      | 다이얼로그 표시            |
| 5.2         | 단일 일정 삭제     | TD-020           | 없음      | 단일 삭제                  |
| 5.3         | 전체 일정 삭제     | TD-021           | 없음      | 전체 삭제                  |
| 에러처리1   | 종료일 검증        | TD-010           | 없음      | 예외 케이스                |
| 제약사항3   | 반복 간격          | TD-026           | 없음      | 경계 케이스                |
| 제약사항4   | ID 관리            | TD-011           | 없음      | 정상 케이스                |
| 특수케이스1 | 31일 매월 반복     | TD-005           | 없음      | 경계 케이스                |
| 특수케이스2 | 윤년 2월 29일      | TD-006           | 없음      | 경계 케이스                |
| 특수케이스3 | 반복 일정 겹침     | TD-012           | 없음      | 정상 케이스                |
| 특수케이스4 | 재수정             | TD-022           | 없음      | 정상 케이스                |

## 4. 테스트 통계

| 분류        | 개수 | 비율  | 비고               |
| ----------- | ---- | ----- | ------------------ |
| 정상 케이스 | 16   | 61.5% | 핵심 기능 검증     |
| 예외 케이스 | 1    | 3.8%  | 에러 처리 검증     |
| 경계 케이스 | 7    | 26.9% | 특수 케이스 검증   |
| 부정 케이스 | 2    | 7.7%  | 잘못된 입력 처리   |
| **총계**    | 26   | 100%  | 전체 테스트 케이스 |

### 우선순위별 분포

| 우선순위 | 개수 | 비율  | 비고                |
| -------- | ---- | ----- | ------------------- |
| High     | 15   | 57.7% | 핵심 기능 우선 실행 |
| Medium   | 9    | 34.6% | 부가 기능 검증      |
| Low      | 2    | 7.7%  | 예외 상황 처리      |
| **총계** | 26   | 100%  | -                   |

### 범위별 분포

| 범위        | 개수 | 비율  | 비고        |
| ----------- | ---- | ----- | ----------- |
| unit        | 16   | 61.5% | 단위 테스트 |
| integration | 10   | 38.5% | 통합 테스트 |
| **총계**    | 26   | 100%  | -           |

## 5. 우선순위별 실행 계획

- **High (15개)**: TD-001, TD-002, TD-003, TD-004, TD-005, TD-006, TD-010, TD-011, TD-013, TD-014, TD-015, TD-016, TD-017, TD-019, TD-020, TD-021
  - 핵심 기능: 반복 유형별 생성, 경계 케이스(31일, 윤년), 수정/삭제 다이얼로그, 단일/전체 수정/삭제
- **Medium (9개)**: TD-007, TD-008, TD-009, TD-012, TD-018, TD-022, TD-025, TD-026
  - 부가 기능: 기본값 확인, 겹침 미검사, 원본 유지, 재수정, 경계 케이스
- **Low (2개)**: TD-023, TD-024
  - 예외 처리: 잘못된 입력 처리

## 6. 리스크 및 의존성

### 리스크

1. **31일 매월 반복 로직**: 31일이 없는 달을 정확히 건너뛰는지 검증 필요 (TD-005)
2. **윤년 계산**: 2월 29일 윤년 판별 로직의 정확성 검증 필요 (TD-006)
3. **반복 일정 ID 관리**: 고유 ID 생성 및 충돌 방지 로직 검증 필요 (TD-011)
4. **단일 수정 후 상태 관리**: 반복 일정에서 분리된 일정의 상태 관리 검증 필요 (TD-016, TD-022)

### 의존성

1. **날짜 유틸리티**: 날짜 계산 및 윤년 판별 함수 필요
2. **반복 일정 생성 유틸리티**: 반복 유형별 날짜 배열 생성 함수 필요
3. **다이얼로그 컴포넌트**: 수정/삭제 범위 선택 다이얼로그 필요
4. **기존 일정 API**: 일정 CRUD 작업을 위한 API 연동 필요

### 데이터 준비

1. **테스트 픽스처**: 다양한 반복 유형의 일정 데이터
2. **날짜 범위**: 2024-01-01 ~ 2025-12-31 범위의 테스트 데이터
3. **윤년 데이터**: 2024년(윤년), 2025년(평년) 데이터

## 7. 다음 단계 메모 (STEP03 참고)

### 테스트 파일 후보

- `src/__tests__/unit/recurringEvents.spec.ts`: 반복 일정 생성 로직 단위 테스트
- `src/__tests__/integration/recurringEventsUI.spec.tsx`: 반복 일정 UI 통합 테스트

### 예상 구현 파일

- `src/utils/recurringEvents.ts`: 반복 일정 생성 유틸리티 함수
- `src/utils/dateUtils.ts`: 날짜 계산 및 윤년 판별 함수 (기존 파일 확장)
- `src/hooks/useRecurringEvents.ts`: 반복 일정 관리 커스텀 훅
- `src/components/RecurringEventDialog.tsx`: 수정/삭제 범위 선택 다이얼로그

### 예상 스텁/픽스처

- `src/__tests__/__mocks__/recurringEventFixtures.ts`: 반복 일정 테스트 데이터
- MSW 핸들러 확장: 반복 일정 API 모킹

### 구현 시 주의 사항

1. **날짜 계산 정확성**: JavaScript Date 객체의 월 인덱스(0-11) 주의
2. **윤년 판별**: 4년마다 윤년, 100년마다 평년, 400년마다 윤년 규칙 적용
3. **ID 생성 규칙**: `${originalId}_${YYYY-MM-DD}` 형식 일관성 유지
4. **상태 관리**: 단일 수정 시 원본 반복 일정과의 연결 해제 로직
5. **성능 고려**: 대량의 반복 일정 생성 시 성능 최적화 필요
