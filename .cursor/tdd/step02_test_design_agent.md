# Test Design Agent Rule

## 📍 현재 단계: 2️⃣ 테스트 설계

**역할**: 기능 명세서를 분석해 테스트 관점의 작업 항목을 정의합니다.
리스크 기반 우선순위를 부여하고 구조화된 테스트 계획을 만듭니다.

**⚠️ 중요**: 이 단계에서는 반드시 설계된 테스트 케이스를 사용자에게 화면에 표시해야 합니다.

## 실행 절차

1. **명세서 읽기**: `docs/project_spec/` 폴더에서 가장 최근 명세서를 읽어옴
2. **명세 분석**: 명세서의 각 기능 섹션을 리스트화하여 테스트 가능한 요구사항 추출
3. **테스트 시나리오 설계**: 모든 커버리지를 고려하여 테스트 케이스 정의
   - 정상 케이스 (Happy Path)
   - 예외 케이스 (Error Cases)
   - 경계 케이스 (Edge Cases)
   - 부정적 케이스 (Negative Cases)
4. **테스트 케이스 노출 (필수)**: 설계된 테스트 케이스를 사용자에게 **반드시 화면에 표시**
   - 전체 테스트 목록을 카테고리별로 분류하여 제시
   - 각 테스트의 ID, 제목, 설명을 포함
   - "⚠️ 설계된 테스트 케이스 노출 (필수)" 섹션의 형식을 따라 표시
5. **우선순위 결정**: 리스크 및 중요도에 따라 우선순위 부여
6. **테스트 범위 결정**: unit/integration/system 범위 결정
7. **명세서-테스트 커버리지 체크리스트**: 명세서의 모든 기능이 테스트로 커버되는지 체크리스트 생성
8. **커버리지 검증 루프**: 설계된 테스트를 체크리스트와 비교하여 누락 확인
9. **누락 식별**: 빠진 케이스가 있으면 명확히 표시
10. **사용자에게 제시**: 누락된 항목을 표 형식으로 사용자에게 제시
11. **사용자 선택 대기**: 추가 여부를 사용자가 명확하게 선택
12. **루프 반복 체크**: 누락이 해결될 때까지 9-13 반복
13. **최종화 전 커버리지 확인**: 모든 누락이 해결되었는지 최종 확인
14. **테스트 계획 최종화**: 모든 케이스를 포함한 최종 테스트 계획 작성

## 작성 규칙

- **테스트 유닛 ID**: `TD-###` 형식의 고유 값 사용
- **테스트 시나리오**: Gherkin 형식 또는 명세 기반으로 명확히 서술
- **우선순위**: High/Medium/Low로 분류
- **범위**: unit/integration/system 명시
- **테스트 케이스 커버리지**:
  - 정상 케이스 (Happy Path)
  - 예외 케이스 (Error Cases)
  - 경계 케이스 (Edge Cases)
  - 부정적 케이스 (Negative Cases)
- **입력/출력 명시**: 각 테스트의 입력값과 기대 결과 명확히 정의
- **전제 조건**: 테스트 실행에 필요한 전제 조건 명시
- **실패 신호**: 실패 시 관찰해야 할 지표 정의

## ⚠️ 설계된 테스트 케이스 노출 (필수)

**중요**: 테스트 설계가 완료되면 **반드시** 먼저 사용자에게 전체 테스트 케이스를 보여줘야 합니다.

### 노출 필수 형식

**반드시 표 형식으로 제시**:

```markdown
# 📝 설계된 테스트 케이스 목록

## 전체 테스트 케이스 (표 형식)

| ID     | 우선순위 | 범위        | 케이스 유형   | 제목                      | 설명                                       | 명세 참조  |
| ------ | -------- | ----------- | ------------- | ------------------------- | ------------------------------------------ | ---------- |
| TD-001 | High     | integration | 정상 케이스   | 일정 추가                 | 제목, 날짜, 시간을 입력하여 일정 생성      | 명세 3.1.1 |
| TD-002 | High     | integration | 정상 케이스   | 일정 수정                 | 기존 일정의 제목과 시간 수정               | 명세 3.1.2 |
| TD-003 | High     | integration | 정상 케이스   | 일정 삭제                 | 일정 목록에서 일정 제거                    | 명세 3.1.3 |
| TD-010 | High     | unit        | 예외 케이스   | 필수 항목 미입력          | 제목 없이 일정 추가 시 에러 토스트         | 명세 3.1.1 |
| TD-011 | High     | unit        | 예외 케이스   | 시간 유효성 검증          | 시작 시간이 종료 시간보다 늦을 때          | 명세 3.1.1 |
| TD-012 | Medium   | integration | 예외 케이스   | 네트워크 오류             | 저장 실패 시 에러 토스트 표시              | 명세 8.1   |
| TD-020 | Low      | integration | 경계 케이스   | 빈 상태 처리              | 일정이 없을 때 "검색 결과가 없습니다" 표시 | 명세 3.2   |
| TD-021 | Low      | integration | 경계 케이스   | 공휴일 표시               | 1월 1일 신정 표시 확인                     | 명세 3.3   |
| TD-022 | Low      | integration | 경계 케이스   | 날짜 이동                 | 주간/월간 뷰 네비게이션 확인               | 명세 3.2   |
| TD-030 | Low      | unit        | 부정적 케이스 | 잘못된 검색어             | 존재하지 않는 일정 검색 시 빈 결과         | 명세 3.4   |
| TD-031 | Medium   | integration | 부정적 케이스 | 겹침 경고 무시            | 겹치는 일정을 강제 저장                    | 명세 3.5   |
| TD-032 | High     | integration | 부정적 케이스 | 존재하지 않는 이벤트 수정 | 잘못된 ID로 수정 시도 시 에러              | 명세 3.1.2 |

---

## 📊 테스트 통계

| 케이스 유형   | 개수     | 비율     |
| ------------- | -------- | -------- |
| 정상 케이스   | 3개      | 25%      |
| 예외 케이스   | 3개      | 25%      |
| 경계 케이스   | 3개      | 25%      |
| 부정적 케이스 | 3개      | 25%      |
| **총계**      | **12개** | **100%** |

## 📈 우선순위 분포

| 우선순위 | 개수 | 비율 |
| -------- | ---- | ---- |
| High     | 5개  | 42%  |
| Medium   | 2개  | 17%  |
| Low      | 5개  | 41%  |

## 🎯 범위 분포

| 범위        | 개수 | 비율 |
| ----------- | ---- | ---- |
| integration | 8개  | 67%  |
| unit        | 4개  | 33%  |
```

### 노출 타이밍

- **4번 단계(테스트 케이스 노출)**에서 먼저 전체 테스트 목록을 사용자에게 제시
- 이어서 7번 단계(체크리스트)에서 명세서와 비교하여 누락 확인

## 명세서-테스트 커버리지 체크리스트 생성

명세서의 모든 섹션과 기능을 분석하여 체크리스트를 생성하고, 설계된 테스트와 매칭합니다.

### 체크리스트 생성 절차

1. **명세서 섹션 추출**: 명세서의 모든 섹션(상세 요구사항, 특수 케이스, 에러 처리 등)을 리스트화
2. **기능 단위 추출**: 각 섹션에서 테스트 가능한 기능 단위를 추출
3. **체크리스트 생성**: 다음과 같은 형식으로 체크리스트 생성

```markdown
# 📋 명세서 vs 테스트 설계 커버리지 체크리스트

## 명세서 정보

- 파일명: docs/project*spec/XXX*.md
- 총 기능 수: [N]개
- 총 테스트 수: [M]개

## 카테고리별 커버리지

### 1. [카테고리명] (예: 일정 관리)

| 순번 | 명세 기능 | 정상 케이스 | 예외 케이스 | 경계 케이스 | 부정적 케이스 | 커버리지 |
| ---- | --------- | ----------- | ----------- | ----------- | ------------- | -------- |
| 1    | 일정 추가 | ✓ TD-001    | ✓ TD-010    | ✓ TD-020    | ✓ TD-030      | ✅ 100%  |
| 2    | 일정 수정 | ✓ TD-002    | ✗ 누락      | ✓ TD-021    | ✓ TD-031      | ⚠️ 75%   |
| 3    | 일정 삭제 | ✓ TD-003    | ✗ 누락      | ✗ 누락      | ✗ 누락        | ❌ 25%   |

### 2. [다음 카테고리]

[반복...]
```

### 4가지 케이스 유형별 체크

각 기능에 대해 다음 4가지 케이스 유형을 체크:

- **정상 케이스 (Happy Path)**: 기본 기능이 정상 동작하는지
- **예외 케이스 (Error Cases)**: 에러 상황 처리가 되는지
- **경계 케이스 (Edge Cases)**: 경계값 처리가 되는지
- **부정적 케이스 (Negative Cases)**: 잘못된 입력에 대한 처리가 되는지

### 커버리지 계산

- **✅ 100%**: 4가지 케이스 모두 포함
- **⚠️ 75%**: 3가지 케이스 포함
- **⚠️ 50%**: 2가지 케이스 포함
- **❌ 25%**: 1가지 케이스만 포함
- **❌ 0%**: 테스트 없음

### 전체 요약

```markdown
## 📊 전체 커버리지 요약

- 총 기능 수: [N]개
- 완전 커버리지 (100%): [A]개
- 부분 커버리지 (75%): [B]개
- 낮은 커버리지 (50%): [C]개
- 미흡 커버리지 (25%): [D]개
- 누락 (0%): [E]개

전체 커버리지: [총 커버 비율]%
```

## 체크리스트 검증 (최종 단계)

테스트 설계 완료 후 반드시 다음 체크리스트 형식으로 명세서와 비교하여 사용자에게 제시:

### 체크리스트 검증 표시 형식

```markdown
# 📋 테스트 커버리지 체크리스트

## 명세서 vs 설계된 테스트 비교

### 1️⃣ [기능명] 기능

| 케이스 유형   | 테스트 포함 여부    | 테스트 ID | 설명                 |
| ------------- | ------------------- | --------- | -------------------- |
| 정상 케이스   | ✓ (포함) / ✗ (누락) | TD-001    | [설명 또는 "누락됨"] |
| 예외 케이스   | ✓ (포함) / ✗ (누락) | TD-010    | [설명 또는 "누락됨"] |
| 경계 케이스   | ✓ (포함) / ✗ (누락) | TD-020    | [설명 또는 "누락됨"] |
| 부정적 케이스 | ✓ (포함) / ✗ (누락) | TD-030    | [설명 또는 "누락됨"] |

#### 관련 명세 항목

- 명세서 3.2: [명세 항목 내용]
- 검증 완료: ✓/✗

---

### 2️⃣ [다음 기능명] 기능

| 케이스 유형   | 테스트 포함 여부 | 테스트 ID | 설명 |
| ------------- | ---------------- | --------- | ---- |
| 정상 케이스   | ✓/✗              | TD-002    | ...  |
| 예외 케이스   | ✓/✗              | TD-011    | ...  |
| 경계 케이스   | ✓/✗              | TD-021    | ...  |
| 부정적 케이스 | ✓/✗              | TD-031    | ...  |

---

[각 기능마다 반복]
```

### 누락 항목 요약 표시

누락된 항목이 있을 경우 다음과 같이 표시:

```markdown
## ⚠️ 누락된 테스트 케이스 요약

총 [N]개 기능, [M]개 누락 항목 발견

### 누락된 항목 목록

| #   | 기능명   | 누락된 케이스 | 중요도 | 비고                  |
| --- | -------- | ------------- | ------ | --------------------- |
| 1   | [기능명] | 정상 케이스   | High   | 핵심 기능 테스트 누락 |
| 2   | [기능명] | 예외 케이스   | Medium | 에러 처리 검증 필요   |
| 3   | [기능명] | 경계 케이스   | Low    | 선택적 추가 가능      |
```

### 권장 테스트 추가 프롬프트

누락된 항목에 대해 구체적인 권장 사항 제시:

```markdown
## 💡 권장 테스트 추가사항

다음 테스트를 추가하시겠습니까?

### 높은 우선순위 (High Priority)

#### 1. [기능명] - [케이스 유형]

**테스트 ID**: TD-XXX  
**제목**: [추천 테스트 제목]

**입력값**:

- 조건1: [값]
- 조건2: [값]

**기대 결과**:

- 결과1: [예상 동작]
- 결과2: [예상 동작]

**테스트 목적**: [왜 필요한지 설명]  
**명세 참조**: [관련 명세 항목]

추가하시겠습니까? (Y/N)

---

#### 2. [다음 추천 테스트]

[반복...]

### 중간 우선순위 (Medium Priority)

[우선순위별로 구분하여 제시]

---

**전체 권장 테스트를 모두 추가하시겠습니까?**

- 옵션 1: 예, 모든 권장 테스트 추가
- 옵션 2: 중요한 것만 추가
- 옵션 3: 아니오, 현재 설계 그대로 진행
```

### 검증 절차 및 반복 루프

#### 1단계: 초기 검증

1. **명세서 분석**: 명세서의 각 기능 섹션을 리스트화
2. **테스트 매칭**: 각 기능에 대해 설계된 테스트를 찾아 매칭
3. **커버리지 확인**: 4가지 케이스 유형별 포함 여부 확인

#### 2단계: 누락 식별 및 사용자 제시

9. **누락 식별**: 빠진 케이스가 있으면 명확히 표시
10. **사용자 제시**: 누락 항목을 표 형식으로 사용자에게 제시
11. **사용자 선택**: 추가 여부를 사용자가 명확하게 선택

#### 3단계: 반복 조건 체크

12. **루프 반복 체크**:
    - **누락이 있으면**: 9번 단계(누락 식별)로 돌아가서 반복
    - **누락이 없으면**: 13번 단계로 진행
    - **사용자가 "필요 없다"고 명확히 선택**: 13번 단계로 진행

#### 4단계: 최종화

13. **최종화 전 커버리지 확인**: 모든 누락이 해결되었는지 최종 확인
14. **테스트 계획 최종화**: 모든 케이스를 포함한 최종 테스트 계획 작성

### 반복 루프 시각화

```
명세 분석 → 테스트 설계 → 우선순위 결정
                           ↓
                    [커버리지 검증 시작]
                           ↓
                    누락 발견?
                  ↙            ↘
              YES                NO
               ↓                  ↓
       사용자에게 제시      테스트 계획 최종화
               ↓
        사용자 선택 대기
               ↓
         테스트 추가
               ↓
         [다시 검증]
```

**중요**:

- 누락이 있을 때마다 반드시 사용자에게 제시하고 확인을 받아야 합니다
- 사용자가 추가를 선택하면 테스트를 추가하고 **9번 단계(누락 식별)**로 돌아가서 다시 커버리지를 확인합니다
- 사용자가 "필요 없다"고 명확히 선택하거나 모든 누락이 해결될 때까지 루프를 반복합니다
- 루프 종료 조건:
  - ✅ **모든 누락이 해결됨** → 14번 단계(최종화)로 진행
  - ✅ **사용자가 "필요 없다"고 명확히 선택** → 남은 누락 항목 기록 후 14번 단계로 진행
