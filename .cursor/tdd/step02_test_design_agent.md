# Test Design Agent Rule

# **STEP02. 테스트 설계**

## 📍 현재 단계: 2️⃣ 테스트 설계

**역할**: STEP01에서 작성된 최신 명세서를 테스트 관점으로 구조화해, STEP03에서 바로 구현 가능한 테스트 설계 문서를 완성합니다. 설계된 테스트를 사용자에게 보여주고, 커버리지 누락이 있다면 추가 여부를 확인받은 뒤 확정합니다.

**⚠️ 필수 규칙 참조 (매 단계 적용)**: 이 단계 실행 전 반드시 다음 규칙을 읽고 준수

- [코드 컨벤션](mdc:.cursor/rules/00. foundation/code_conventions.mdc): 모든 코드 작성 시 엄격히 준수
- [커밋 컨벤션](mdc:.cursor/rules/00. foundation/commit_conventions.mdc): 커밋 메시지 작성 시 준수
- [프로젝트 구조](mdc:.cursor/rules/00. foundation/project_structure.mdc): 파일 배치 및 경로 결정 시 준수
- **⚠️ 언어 규칙 (절대 필수)**: 모든 문서 및 코드 주석은 **한글과 영어만 사용**해야 합니다. 중국어, 일본어 등 다른 언어는 절대 사용 금지

**핵심 목표**

- 명세 요구사항·리스크를 토대로 정상/예외/경계/부정 케이스를 빠짐없이 설계
- 테스트 ID, 우선순위, 범위를 명확히 정의해 실행 가능한 계획 수립
- 명세 대비 커버리지와 리스크 메모를 포함하여 사용자에게 보고
- 명세 대비 커버리지가 누락없이 작성되었거나 사용자가 확인 시 문서로 작성
- STEP03이 바로 사용할 수 있는 테스트 TODO 요약을 남기고 종료

**입력 전제**

- `docs/project_spec/`의 최신 명세 파일(파일명·버전·요약 포함)
- STEP01 요약 정보(핵심 기능, 제약, 리스크)
- 기존 테스트 설계 문서가 있다면 참조하되 중복/충돌 여부 확인

**사용자 인터랙션**

- 설계된 테스트 목록(명세 참조 포함)을 표로 보여준 뒤 사용자 피드백을 반영합니다.
- 명세 번호별 TD 매칭 표를 생성해 사용자에게 공유하고, 누락 시 추가 설계 여부를 묻습니다.
- 모든 누락 처리가 끝나면 최종 테스트 목록·통계·명세 매칭 표를 다시 보여주고 승인을 받습니다.

**주요 산출물**

1. 테스트 케이스 테이블 (TD-###, 우선순위, 범위, 케이스 유형, 전제, 입력, 기대 결과, 실패 신호, 명세 참조 포함)
2. 명세 vs 테스트 커버리지 매트릭스 (기능 항목별 케이스 유형 충족 여부)
3. 통계 및 우선순위별 실행 계획
4. 리스크/의존성 노트 및 다음 단계 메모
5. 문서 저장: `docs/test_design/###_기능명_test_design.md`
6. **⚠️ STEP02 요약 (화면 표시 필수)**: 테스트 TODO 리스트, 커버리지 상태, 명세 매칭 상태, 리스크 요약을 표 형식으로 화면에 표시하여 사용자가 확인할 수 있도록 함

## 진행 절차

### A. 준비

1. **명세 분석**: 최신 명세 파일을 열어 섹션·요구사항 번호·예외 규칙·제약을 정리하고, 주요 기능별 리스크를 메모합니다.
2. **기능 단위 추출**: 테스트 가능한 요구사항을 목록화하고, 입력/출력/상태 변화/에러 처리 기준을 명확히 합니다.

### B. 테스트 케이스 설계

3. **케이스 도출**: 각 기능에 대해 정상, 예외, 경계, 부정 케이스를 최소 하나씩 검토하며 테스트를 정의합니다.
4. **속성 기입**: 테스트 ID(`TD-###`), 제목, 케이스 유형, 우선순위(High/Medium/Low), 범위(unit/integration/system), 전제·입력, 기대 결과, 실패 신호, 명세 참조를 작성합니다.
5. **우선순위 결정**: 리스크·사용 빈도·데이터 민감도를 고려해 우선순위를 부여하고, 실행 순서를 제안합니다.
6. **초기 목록 공유**: 설계된 전체 테스트 케이스 표와 명세-테스트 매칭 표를 화면에 표시합니다. 사용자 피드백이 있으면 반영하되, 자동 진행을 위해 대기 시간을 최소화합니다.

### C. 커버리지 검증

7. **커버리지 매트릭스 작성**: 명세 항목별로 네 가지 케이스 유형이 충족되는지 표로 정리합니다.
8. **누락 검토 및 자동 보완**: 누락 항목이 있으면 명세-테스트 매칭 표에 반영하여 화면에 표시하고, 즉시 테스트를 보완합니다. 사용자 확인 없이 자동으로 누락 항목을 채워 7~8단계를 반복해 커버리지를 100% 달성합니다.
9. **통계 계산**: 케이스 유형/우선순위/범위 분포를 계산해 문서에 포함합니다.

### D. 문서화 및 요약

10. **최종 목록 확인**: 보완된 테스트 케이스 표·통계·명세-테스트 매칭 표를 화면에 표시합니다. 자동 진행을 위해 즉시 다음 단계로 이동합니다.
11. **⚠️ STEP02 요약 화면 표시 (절대 필수)**: 사용자에게 STEP02 요약을 화면에 표 형식으로 **먼저** 표시
    - "STEP02 요약 (반드시 화면에 표시!)" 섹션의 형식을 정확히 따라 표시
    - STEP02 요약 정보 표 (총 테스트 수, 우선순위 분포, 커버리지 상태, 명세 매칭 상태)
    - 테스트 TODO 목록 표 (ID, 유형, 우선순위, 요약)
    - 구현 시 주의사항 (리스크, 힌트)
    - 다음 단계 안내
    - STEP02 요약을 표시한 후 즉시 문서 작성 및 커밋을 진행합니다 (자동 진행)
12. **문서 작성**: STEP02 요약 표시 후, 아래 템플릿을 사용해 테스트 설계 문서를 작성합니다.
13. **파일 저장**: `docs/test_design/###_기능명_test_design.md` 형식으로 파일 저장
14. **⚠️ 커밋 실행 (절대 필수)**: 파일 저장 후 반드시 커밋 실행
    - 문서 저장 후 즉시 커밋을 수행합니다
    - 커밋이 성공할 때까지 이 단계를 종료하지 않습니다
    - 커밋 완료 후 자동으로 다음 단계(STEP03)로 진행합니다

## 템플릿

### 1. 테스트 설계 문서 구조

```markdown
# 테스트 설계 문서 - [기능명]

## 1. 명세서 정보

- 명세서 파일: docs/project_spec/###\_feature.md
- 분석 메모: [핵심 기능, 제약, 리스크 요약]

## 2. 전체 테스트 케이스

| ID     | 우선순위 | 범위        | 케이스 유형 | 제목 | 설명 | 명세 참조 | 전제·입력 | 기대 결과 | 실패 신호 |
| ------ | -------- | ----------- | ----------- | ---- | ---- | --------- | --------- | --------- | --------- |
| TD-001 | High     | integration | 정상 케이스 | ...  | ...  | 명세 1.1  | ...       | ...       | ...       |
| TD-002 | Medium   | unit        | 예외 케이스 | ...  | ...  | 명세 1.2  | ...       | ...       | ...       |
| ...    | ...      | ...         | ...         | ...  | ...  | ...       | ...       | ...       | ...       |

## 3. 명세 vs 테스트 커버리지

| 명세 항목     | 정상    | 예외    | 경계    | 부정    | 담당 테스트                    | 메모            |
| ------------- | ------- | ------- | ------- | ------- | ------------------------------ | --------------- |
| 1.1 일정 추가 | ✓TD-001 | ✓TD-010 | ✓TD-020 | ✓TD-030 | TD-001, TD-010, TD-020, TD-030 | 4가지 유형 충족 |
| ...           | ...     | ...     | ...     | ...     | ...                            | ...             |

## 3-1. 명세-테스트 매칭 목록

| 명세 번호 | 명세 설명           | 매핑된 테스트 ID | 누락 여부 | 비고 |
| --------- | ------------------- | ---------------- | --------- | ---- |
| 1.1       | 일정 추가 기본 흐름 | TD-001, TD-005   | 없음      |      |
| 1.2       | 반복 옵션 설정      | TD-002, TD-006   | 없음      |      |
| ...       | ...                 | ...              | ...       | ...  |

## 4. 테스트 통계

| 분류        | 개수 | 비율 | 비고 |
| ----------- | ---- | ---- | ---- |
| 정상 케이스 |      |      |      |
| 예외 케이스 |      |      |      |
| 경계 케이스 |      |      |      |
| 부정 케이스 |      |      |      |
| **총계**    |      | 100% |      |

## 5. 우선순위별 실행 계획

- **High**: TD-001, TD-010, ...
- **Medium**: ...
- **Low**: ...

## 6. 리스크 및 의존성

- [리스크 항목, 모호한 명세, 데이터 준비 이슈 등]

## 7. 다음 단계 메모 (STEP03 참고)

- 테스트 파일 후보: ...
- 예상 스텁/픽스처: ...
- 구현 시 주의 사항: ...
```

### 2. STEP02 테스트 설계 요약 (반드시 화면에 표시!)

**⚠️ 필수**: 문서 저장 전에 반드시 아래 형식으로 화면에 표시합니다 (자동 진행을 위해 즉시 다음 단계로 이동)

```markdown
# 📋 STEP02 테스트 설계 요약

| 항목           | 내용                                        |
| -------------- | ------------------------------------------- |
| 설계 문서 파일 | docs/test*design/###*기능명\_test_design.md |
| 총 테스트 수   | [N]개                                       |
| 우선순위 분포  | High: [A]개, Medium: [B]개, Low: [C]개      |
| 커버리지 상태  | ✅ 100% / 누락 없음 (또는 ⚠️ 일부 누락)     |
| 다음 단계      | 3️⃣ 테스트 작성 (RED)                        |
```

**⚠️ 중요**: 이 STEP02 요약을 화면에 표시하지 않고는 STEP02를 종료할 수 없습니다!

### 추가 정보 (필요시 표시)

**테스트 TODO 목록 (요약)**:

| ID     | 명세 번호 | 유형        | 우선순위 | 요약   |
| ------ | --------- | ----------- | -------- | ------ |
| TD-001 | 1.1       | 정상 케이스 | High     | [요약] |
| TD-010 | 1.2.1     | 예외 케이스 | High     | [요약] |
| TD-020 | 2.3       | 경계 케이스 | Medium   | [요약] |
| ...    | ...       | ...         | ...      | ...    |

**구현 시 주의사항 (리스크)**:

- ⚠️ 리스크 1: [핵심 리스크 요약]
- ⚠️ 리스크 2: [핵심 리스크 요약]
- 💡 힌트: [구현 시 도움이 될 정보]

## 커밋 체크리스트

- ✅ 사용자와 함께 최종 테스트 목록·통계·매칭 표 확인
- ✅ STEP02 요약 화면 표시 완료 (사용자 확인)
- ✅ 테스트 설계 문서 저장 및 번호 갱신 확인

**⚠️ 커밋 실행 (절대 필수)**: STEP02 요약 표시 후 파일 저장이 완료되면 반드시 실제 git 커밋을 실행해야 합니다

- `run_terminal_cmd` 도구를 사용하여 다음 명령을 실행:

  ```bash
  git add docs/test_design/###_기능명_test_design.md
  git commit -m "chore(docs): add test design for [기능명]" \
    -m "총 테스트 케이스: [N]개
  - High : [A]개, Medium: [B]개, Low: [C]개
  - 테스트 설계 문서: docs/test_design/###_기능명_test_design.md
  ```

- **커밋이 성공적으로 완료될 때까지 이 단계를 절대 종료하지 않음**
- 커밋 실패 시 에러를 확인하고 재시도
- 커밋 완료 후 자동으로 다음 단계(STEP03)로 진행합니다

커밋 메시지는 `.cursor/rules/00. foundation/commit_conventions.mdc`를 따른다.

---

STEP02는 테스트 설계 문서를 저장하고 **커밋까지 완료**해야 종료됩니다.
