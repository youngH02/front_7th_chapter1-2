# Test Author Agent Rule (RED)

# **STEP03. 테스트 작성 (RED)**

## 📍 현재 단계: 3️⃣ 테스트 작성 (RED)

**역할**: 기능 명세를 기반으로 실패하는 테스트 코드를 작성한다.
아직 구현되지 않은 기능이 명확히 드러나도록 RED 상태를 만든다.

**⚠️ 필수**:

- **모든 테스트 코드를 한 번에 완성**해야 합니다
- **설계서의 모든 테스트 케이스를 100% 포함**해야 합니다
- 이후 단계(GREEN, 리팩토링 등)에서 **테스트 코드 수정 금지**
- **체크리스트를 반드시 화면에 표시하고 사용자 확인을 받아야 함**
- **문서로만 저장하면 안됨! 반드시 화면에 보여줘야 함**
- **⚠️ 테스트 설계 번호 포함 필수**: 각 `it()` 테스트 제목에 TD-### 번호 반드시 포함
  - 형식: `it('TD-001: 테스트 제목', () => { ... })`
- **⚠️ 실제 테스트 로직 구현 필수**: `expect(true).toBe(false)` 같은 단순 실패 금지!
  - 실제 함수 호출, 실제 검증 로직 작성
  - 구현 코드가 없어서 실패하는 것이 RED 상태

## 실행 절차

**⚠️ 반드시 지켜야 할 규칙**: 이 단계는 파일 작성만 하면 안되고, 반드시 화면에 표시하고 사용자 확인을 받아야 합니다!

1. **테스트 설계서 읽기**: `docs/test_design/`에서 최근 테스트 설계 문서를 읽어옴
2. **테스트 체크리스트 생성**: 설계서의 모든 테스트 케이스를 체크리스트로 생성
3. **빈 구현 파일 먼저 생성**: import 에러를 방지하기 위해 빈 구현 파일을 먼저 생성한다.
4. **⚠️ 테스트 코드 실제 로직 작성**: 설계된 모든 테스트 케이스를 실제 로직으로 작성한다
   - **필수**: 각 `it()` 테스트에 설계서의 TD-### 번호를 반드시 포함
   - **형식**: `it('TD-001: 테스트 제목 - 테스트 설명', () => { ... })`
   - 단순 실패(`expect(true).toBe(false)`) 금지!
   - 실제 테스트 로직과 예상 결과를 모두 작성
   - 구현 코드가 없어서 실패하는 상태가 되어야 함
5. **⚠️ 설계서-실제 테스트 매칭 체크리스트 생성**: 작성한 테스트가 설계서의 모든 케이스를 포함하는지 체크리스트로 검증
6. **⚠️ 매칭 체크리스트 화면 표시 (절대 필수)**: 생성한 체크리스트를 반드시 화면에 표 형식으로 표시
   - "테스트 설계서-실제 코드 매칭 체크리스트" 섹션의 표 형식 사용
   - 표 전체를 화면에 보여주고 사용자의 반응을 기다림
7. **누락 테스트 식별 및 화면 표시**: 누락된 테스트가 있으면 화면에 명확히 표시
8. **⚠️ 누락 테스트 자동 추가**: 누락된 테스트를 사용자 확인 없이 자동으로 전부 추가
9. **루프 반복**: 누락이 있으면 7-8번을 반복하여 누락된 테스트를 모두 추가
10. **최종 매칭 확인**: 모든 설계서 테스트가 100% 포함되었는지 최종 확인

- 누락이 있으면 7-9번으로 돌아가서 계속 추가
- 누락이 없을 때만 다음 단계로 진행

11. **⚠️ 최종 화면 표시**: 누락 보완 완료된 최종 테스트 코드를 화면에 표 형식으로 표시
12. **테스트 실행**: `echo "q" | pnpm test [파일명]`으로 RED 상태를 확인한다.
13. **완료 보고**: 테스트 작성 완료 요약 제시
14. **커밋**: `test(td-red): add failing tests for [기능명]` 형식으로 커밋

## ⚠️ RED 단계 테스트 작성 규칙

RED 단계에서는 테스트 코드가 실제로 작동해야 합니다.

### 올바른 RED 테스트 작성법

```typescript
// ✅ 올바른 RED 테스트 예시 (TD 번호 포함 필수!)
describe('getWeekDates', () => {
  it('TD-015: 주중의 날짜(수요일)에 대해 올바른 주의 날짜들을 반환한다', () => {
    const date = new Date('2025-07-09'); // 수요일
    const weekDates = getWeekDates(date); // 실제 함수 호출
    expect(weekDates).toHaveLength(7); // 실제 검증
    expect(weekDates[0].toISOString().split('T')[0]).toBe('2025-07-06');
    expect(weekDates[6].toISOString().split('T')[0]).toBe('2025-07-12');
  });

  it('TD-016: 주의 시작(월요일)에 대해 올바른 주의 날짜들을 반환한다', () => {
    const date = new Date('2025-07-07'); // 월요일
    const weekDates = getWeekDates(date);
    expect(weekDates).toHaveLength(7);
    expect(weekDates[0].toISOString().split('T')[0]).toBe('2025-07-06');
    expect(weekDates[6].toISOString().split('T')[0]).toBe('2025-07-12');
  });
});
```

이 테스트는:

- ✅ 실제 함수를 호출하고
- ✅ 실제 결과를 검증하지만
- ❌ 구현 코드가 없어서 실패함 (RED 상태)

### 잘못된 RED 테스트 작성법

```typescript
// ❌ 잘못된 예시 1: TD 번호 누락
describe('월말 경계 처리', () => {
  it('3월 31일 설정 시 4월에는 생성 안 함', () => {
    // TD 번호 없음!
    expect(true).toBe(false);
  });
});

// ❌ 잘못된 예시 2: 단순 실패만
describe('월말 경계 처리', () => {
  it('TD-018: 3월 31일 설정 시 4월에는 생성 안 함', () => {
    expect(true).toBe(false); // 이것은 테스트가 아님!
  });
});
```

### 올바른 RED 테스트 작성법 (수정)

```typescript
// ✅ 올바른 예시: TD 번호 포함 + 실제 로직
describe('월말 경계 처리', () => {
  it('TD-018: 3월 31일 설정 시 4월에는 생성 안 함', () => {
    const event = {
      startDate: new Date('2025-03-31'),
      repeatType: 'monthly',
    };
    const occurrences = generateRecurringEvents(event, new Date('2025-04-30'));
    const aprilEvents = occurrences.filter((e) => e.startDate.getMonth() === 3); // 4월 = month 3
    expect(aprilEvents).toHaveLength(0); // 4월에는 생성 안 함
  });
});
```

**요약**:

- ✅ TD-### 번호를 `it()` 제목에 포함
- ✅ 실제 함수 호출과 검증 로직 작성
- ❌ 단순 실패만 하는 테스트 금지

## 작성 규칙

- **파일 배치**: `src/__tests__` 하위에 적절한 서브폴더(unit/integration/e2e) 사용
- **파일 확장자**:
  - Unit 테스트 (로직만): `.spec.ts`
  - Render 테스트 (React 컴포넌트): `.spec.tsx`
- **⚠️ 필수: 실제 테스트 로직 구현**

  - **금지**: `expect(true).toBe(false);` 같은 단순 실패만 하는 테스트는 금지!
  - **필수**: 실제 테스트 로직을 완전히 작성해야 함
  - **예시**:

    ```typescript
    // ❌ 잘못된 예시
    it('함수를 호출하면 결과를 반환한다', () => {
      expect(true).toBe(false); // 이것은 테스트가 아님!
    });

    // ✅ 올바른 예시
    it('함수를 호출하면 결과를 반환한다', () => {
      const result = someFunction('input');
      expect(result).toBe('expected output');
    });
    ```

  - **RED 상태**: 구현 코드가 없거나 빈 구현이어서 테스트가 실패하는 것
  - **테스트 코드**: 실제 로직과 예상 결과를 작성하되, 구현이 없어서 실패함

- **테스트 케이스 완성도**: 스펙의 모든 시나리오를 커버
  - 정상 케이스 (Happy Path)
  - 예외 케이스 (Error Cases)
  - 경계 케이스 (Edge Cases)
  - 부정적 케이스 (Negative Cases)
- **테스트 함수**: `it()` 함수를 사용하고 명확한 설명 포함
  - **⚠️ 필수**: 각 `it()` 테스트 제목에 설계서의 TD-### 번호를 반드시 포함
  - **형식**: `it('TD-001: 테스트 제목 - 테스트 설명', () => { ... })`
  - **예시**: `it('TD-001: 일정 추가 - 제목, 날짜, 시간을 입력하여 일정 생성', () => { ... })`
- **코드 컨벤션**: `.cursor/rules/00. foundation/` 규칙 준수
- **테스트 실행**: 생성된 테스트 파일만 지정하여 실행하고 자동 종료
- **⚠️ 중요**: 설계서의 모든 테스트 케이스를 반드시 포함해야 함
- **⚠️ 금지**: 이후 단계(GREEN, 리팩토링 등)에서는 테스트 코드를 절대 수정하지 않음

## 커밋 규칙

### 커밋 메시지 형식

```
test(td-red): add failing tests for [기능명]

- 테스트 파일: [파일명]
- 테스트 케이스 수: [N]개
- 상태: 실패 (RED) - 의도된 실패
```

### 커밋 시점

- **빈 구현 파일 생성 후**: 빈 파일만 먼저 커밋
- **테스트 코드 작성 후**: 실패하는 테스트 코드 커밋
- RED 상태 확인 후 진행

## 테스트 설계서-실제 코드 매칭 체크리스트 (절대 필수)

**⚠️ CRITICAL**: 설계서에 나온 모든 테스트가 실제 코드에 100% 반영되어야 합니다!

테스트 코드 작성 후 반드시 다음을 수행:

1. **설계서 전체 읽기**: `docs/test_design/###_기능명_test_design.md` 파일의 모든 내용 읽기
2. **설계서 테스트 전부 추출**: 설계서의 모든 TD-### 테스트를 하나도 빠짐없이 추출
3. **실제 코드 테스트 전부 추출**: 작성한 모든 테스트 파일에서 테스트 케이스 추출
4. **1:1 완전 매칭**: 설계서의 각 테스트가 실제 코드에 있는지 확인
5. **누락 정확히 식별**: 누락된 테스트를 정확하게 식별
6. **화면에 표시**: 누락된 테스트를 표 형식으로 반드시 화면에 표시
7. **사용자 확인 대기**: 사용자에게 추가 여부를 물어보고 선택할 때까지 기다림

**주의**: 설계서에 30개 나와있으면 실제 코드에도 30개 있어야 합니다!

### 체크리스트 생성 형식

````markdown
# ✅ 테스트 설계서 vs 실제 테스트 코드 매칭 체크리스트

## 설계서 정보

- 설계서 파일: docs/test*design/###*기능명\_test_design.md
- 설계 테스트 수: [N]개
- 작성 테스트 수: [M]개

## 테스트 케이스별 매칭 확인 (설계서의 모든 테스트를 반드시 전체 나열!)

**⚠️ 필수**: 설계서의 모든 TD-### 테스트를 하나도 빠짐없이 아래 표에 전체 나열!

| 순번 | ID     | 설계 테스트 내용                                 | 설계서 위치 | 실제 코드 | 테스트 파일                    | 매칭 결과 | 비고          |
| ---- | ------ | ------------------------------------------------ | ----------- | --------- | ------------------------------ | --------- | ------------- |
| 1    | TD-001 | 일정 추가 - 제목, 날짜, 시간 입력                | 1번         | ✅        | src/**tests**/.../test.spec.ts | ✅ 일치   |               |
| 2    | TD-002 | 일정 수정 - 제목과 시간 수정                     | 2번         | ✅        | src/**tests**/.../test.spec.ts | ✅ 일치   |               |
| 3    | TD-003 | 일정 삭제 - 일정 제거                            | 3번         | ✗         | -                              | ❌ 누락   | **추가 필요** |
| 4    | TD-010 | 필수 항목 미입력 - 에러 처리                     | 10번        | ✅        | src/**tests**/.../test.spec.ts | ✅ 일치   |               |
| 5    | TD-011 | 시간 유효성 검증                                 | 11번        | ✗         | -                              | ❌ 누락   | **추가 필요** |
| ...  | ...    | [설계서의 모든 나머지 테스트를 여기에 전체 나열] | ...         | ...       | ...                            | ...       | ...           |

**계속해서 설계서의 모든 테스트(N개)를 반드시 전부 나열해야 함!**

**총 설계 테스트 수**: [N]개  
**실제 작성 테스트 수**: [M]개  
**누락**: [N-M]개

## 📊 매칭 통계

| 상태     | 개수      | 비율     |
| -------- | --------- | -------- |
| ✅ 일치  | [A]개     | [%]      |
| ❌ 누락  | [B]개     | [%]      |
| **총계** | **[N]개** | **100%** |

**매칭률**: [X]%

## ⚠️ 누락된 테스트 상세 (반드시 화면에 표시 후 자동 추가)

누락된 테스트가 있으면 반드시 아래 형식으로 화면에 표시하고, 사용자 확인 없이 자동으로 전부 추가합니다:

```markdown
# ⚠️ 누락된 테스트 케이스

총 **[M]개**의 테스트가 설계서에는 있지만 실제 코드에 누락되었습니다.

## 누락된 테스트 목록

### 1. TD-003: 일정 삭제 테스트

- **설계 내용**: 일정 목록에서 일정 제거
- **설계서 위치**: "### 정상 케이스" 섹션 3번
- **중요도**: ⭐⭐⭐ High
- **추가 이유**: 핵심 기능이므로 반드시 필요
- **추가 필요여부**: □ 추가 필요

### 2. TD-011: 시간 유효성 검증

- **설계 내용**: 시작 시간이 종료 시간보다 늦을 때 에러 처리
- **설계서 위치**: "### 예외 케이스" 섹션 2번
- **중요도**: ⭐⭐⭐ High
- **추가 이유**: 데이터 무결성 보장
- **추가 필요여부**: □ 추가 필요

### 3. TD-020: 빈 상태 처리

- **설계 내용**: 일정이 없을 때 "검색 결과가 없습니다" 표시
- **설계서 위치**: "### 경계 케이스" 섹션 1번
- **중요도**: ⭐⭐ Medium
- **추가 이유**: 사용자 경험 개선
- **추가 필요여부**: □ 추가 필요

[계속...]

---

## ⚠️ 자동 추가 처리

총 [M]개의 누락된 테스트를 확인했습니다. **사용자 확인 없이 자동으로 전부 추가**합니다.

### 추가 진행 상황

- TD-003: 추가 완료 ✅
- TD-011: 추가 완료 ✅
- TD-020: 추가 완료 ✅
  [계속... 모든 누락 테스트 추가]

**모든 누락 테스트 추가 완료**. 다시 매칭 체크를 진행합니다.
```

**⚠️ 중요**:

- 누락된 테스트가 있으면 반드시 화면에 표시!
- **사용자에게 물어보지 말고 자동으로 전부 추가!**
- 누락이 완전히 해결될 때까지 반복 체크!
- 누락이 없어야만 다음 단계로 진행!
````

### 완료 보고 형식 (12번 단계)

```markdown
# ✅ 테스트 작성 (RED) 단계 완료

## 📋 작업 요약

| 항목             | 내용                   |
| ---------------- | ---------------------- |
| 설계서 테스트 수 | [N]개                  |
| 작성 테스트 수   | [M]개                  |
| 매칭률           | [X]%                   |
| 테스트 상태      | ⚠️ 실패 (RED) - 의도됨 |
| 커밋 준비        | ✅ 준비 완료           |
| 다음 단계        | 4️⃣ 기능 구현 (GREEN)   |

## 커밋 수행

**⚠️ 필수 조건**: 다음 모든 조건을 만족해야만 커밋 가능합니다:

- ✅ 테스트 코드 작성 완료 clar
- ✅ 설계서 매칭 체크 완료
- ✅ **누락 테스트 없음 (100% 매칭)** - 필수!
- ✅ 누락 보완 완료
- ✅ RED 상태 확인 완료

**중요**: 누락이 있으면 커밋하지 않고 다시 추가해야 합니다!
```

### 매칭 절차 (절대 필수)

**⚠️ 설계서에 30개 나와있으면 실제 코드에도 30개 있어야 합니다! 누락되면 안됩니다!**

1. **설계서 전체 읽기**: `docs/test_design/###_기능명_test_design.md` 파일을 처음부터 끝까지 읽기
2. **설계서 테스트 전부 추출**: 설계서의 모든 TD-### 형식 테스트를 하나도 빠짐없이 추출
   - 표 형식으로 정리된 모든 테스트
   - 각 테스트의 ID, 제목, 설명 모두 추출
3. **실제 코드 테스트 전부 추출**: 작성한 모든 테스트 파일을 읽어 실제 테스트 내용 추출
4. **1:1 완전 매칭**: 설계서의 각 TD-###가 실제 코드에 있는지 하나씩 확인
5. **누락 정확히 식별**: 누락된 테스트를 정확하게 식별하고 목록 작성
6. **체크리스트 생성**: 위 형식으로 모든 테스트를 포함한 체크리스트 생성
7. **⚠️ 체크리스트 화면 표시 (필수)**: 체크리스트를 반드시 화면에 표 형식으로 표시
8. **⚠️ 누락 화면 표시 (필수)**: 누락된 테스트를 상세하게 화면에 표시
9. **⚠️ 누락 테스트 자동 추가 (필수)**: 누락된 테스트를 사용자 확인 없이 자동으로 전부 추가
10. **루프 반복**: 누락이 있으면 8-9번을 반복 (모든 누락 해결될 때까지)
11. **최종 매칭 확인**: 설계서의 모든 테스트가 100% 포함되었는지 최종 확인
    - 누락이 있으면 8-10번으로 돌아가서 계속 추가
    - 누락이 없을 때만 다음 단계로 진행
12. **⚠️ 최종 화면 표시**: 누락 보완 완료된 모든 테스트 코드를 표 형식으로 화면에 표시
