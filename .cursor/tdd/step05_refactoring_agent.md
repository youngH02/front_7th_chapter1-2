# Refactoring Agent Rule

# **STEP05. 리팩토링**

## 📍 현재 단계: 5️⃣ 리팩토링

**역할**: 통과한 테스트를 유지한 채 코드 품질을 개선한다.
테스트가 깨지지 않도록 안전하게 리팩토링한다.

**⚠️ 금지 사항**:

- **테스트 코드 수정 절대 금지** - RED 단계에서 작성한 테스트를 변경하면 안됨
- 테스트 코드는 건드리지 않고 구현 코드만 리팩토링
- 테스트 재실행으로 모든 테스트가 여전히 통과하는지 확인 필수

## 실행 절차

1. **리팩토링 수행**: 테스트를 깨뜨리지 않는 선에서 코드 개선
2. **테스트 실행**: `echo "q" | pnpm test [파일명]`으로 테스트가 여전히 통과하는지 확인
3. **개선 내용 명시**: 어떤 부분을 어떻게 개선했는지 구체적으로 설명하고 결과를 공유
4. **⚠️ 커밋 실행 (필수)**: `refactor(td-refactor): improve [기능명]` 형식으로 **실제 git 커밋을 실행**

## 작성 규칙

- **테스트 코드 수정 금지**: 테스트 코드는 절대 수정하지 않는다
- **구현 코드만 리팩토링**: `src` 폴더 내의 기능 구현 코드만 리팩토링
- **코드 컨벤션**: `.cursor/rules/00. foundation/` 규칙 엄격히 준수
- **리팩토링 범위**:
  - 코드 중복 제거
  - 가독성 개선
  - 성능 최적화
  - 구조 개선
- **신규 기능 추가 금지**: 테스트 통과와 무관한 신규 기능은 추가하지 않음
- **테스트 유지**: 리팩토링 후에도 모든 테스트가 통과해야 함

## 커밋 체크리스트

- ✅ 리팩토링 후 테스트 통과 확인
- ✅ 개선 내용과 영향 범위를 요약해 공유
- ✅ 부작용 여부 점검 (동작/성능/타 모듈)

**⚠️ 커밋 실행 (절대 필수)**: 이 단계를 마치기 전에 반드시 실제 git 커밋을 실행해야 합니다

- `run_terminal_cmd` 도구를 사용하여 다음 명령을 실행:

  ```bash
  git add src/**/*.ts src/**/*.tsx
  git commit -m "refactor(td-refactor): improve [기능명]" \
    -m "Improvements:
  - [구체적 개선 사항 1]
  - [구체적 개선 사항 2]

  Changed Files:
  - src/[경로]/[파일명].ts

  Reason: [가독성/성능/구조 개선 등]
  Test Status: 모든 테스트 통과"
  ```

- **커밋이 성공적으로 완료될 때까지 이 단계를 절대 종료하지 않음**
- 커밋 실패 시 에러를 확인하고 재시도
- 커밋 완료 후 다음 단계로 진행

위 조건을 충족한 뒤 **STEP05 종료 전에 반드시 커밋**합니다.

5. **⚠️ STEP05 요약 표시 (절대 필수)**: 리팩토링 완료 후 즉시 STEP05 요약 표를 화면에 표시합니다

## STEP05 요약 (반드시 화면에 표시!)

**⚠️ 필수**: 커밋 전에 반드시 아래 형식으로 화면에 표시하여 사용자가 확인할 수 있도록 해야 합니다!

```markdown
# 📋 STEP05 리팩토링 요약

| 항목           | 내용                                         |
| -------------- | -------------------------------------------- |
| 변경 파일      | src/[경로]/[파일명].ts                       |
| 개선 내용 요약 | [구체적 개선 사항 1]<br>[구체적 개선 사항 2] |
| 테스트 상태    | ✅ 모든 테스트 통과                          |
| 다음 단계      | 6️⃣ 최종 검증                                 |
```

**⚠️ 중요**: 이 STEP05 요약을 화면에 표시하지 않고는 STEP05를 종료할 수 없습니다!

---

STEP05는 리팩토링 완료와 **커밋까지 완료**해야 종료됩니다.
